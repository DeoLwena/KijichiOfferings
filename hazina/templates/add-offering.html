<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />

<div class="row mb-4 border-bottom pb-4">
    <div class="col-md-6">
        <label class="form-label fw-bold small text-teal text-uppercase">1. Chagua Mtoaji (Member)</label>
        <div class="shadow-sm" style="border-radius: 12px;">
            <select class="form-select border-0 p-3 select2-field" name="mtoaji" id="memberSelect" required>
                <option value="" selected disabled>Tafuta Mshiriki kwa Jina au Namba...</option>
                {% for mtoaji in watoaji %}
                <option value="{{ mtoaji.id }}">
                    {{ mtoaji.jina_la_kwanza }} {{ mtoaji.jina_la_mwisho }} ({{ mtoaji.namba_ya_ushirika }})
                </option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="col-md-6">
        <label class="form-label fw-bold small text-teal text-uppercase">2. Tarehe ya Sabato</label>
        <input type="date" class="form-control border-0 bg-light p-3 shadow-sm" style="border-radius: 12px;" required>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
    $(document).ready(function() {
        // Initialize Select2 for the Member dropdown
        $('#memberSelect').select2({
            theme: 'bootstrap-5',
            placeholder: 'Anza kuandika jina...',
            allowClear: true,
            width: '100%'
        });

        // Add Row Logic
        document.getElementById('addRow').addEventListener('click', function() {
            const tableBody = document.querySelector('#offeringTable tbody');
            const firstRow = document.querySelector('.offering-row');
            const newRow = firstRow.cloneNode(true);

            newRow.querySelectorAll('input').forEach(input => input.value = '');
            newRow.querySelectorAll('select').forEach(select => select.selectedIndex = 0);

            tableBody.appendChild(newRow);
            attachRemoveEvent();
        });
    });

    function attachRemoveEvent() {
        document.querySelectorAll('.remove-row').forEach(button => {
            button.onclick = function() {
                const rows = document.querySelectorAll('.offering-row');
                if (rows.length > 1) {
                    this.closest('tr').remove();
                    calculateTotal();
                } else {
                    alert("Lazima uwe na angalau mstari mmoja.");
                }
            };
        });
    }

    document.addEventListener('input', function(e) {
        if (e.target.classList.contains('kiasi-input')) {
            calculateTotal();
        }
    });

    function calculateTotal() {
        let total = 0;
        document.querySelectorAll('.kiasi-input').forEach(input => {
            const val = parseFloat(input.value) || 0;
            total += val;
        });
        document.getElementById('grandTotal').innerText = 'Tsh ' + total.toLocaleString();
    }

    attachRemoveEvent();
</script>

<style>
    /* Custom CSS to match your UI with Select2 */
    .select2-container--bootstrap-5 .select2-selection {
        border: none !important;
        padding: 0.75rem !important;
        height: auto !important;
        background-color: white !important;
        border-radius: 12px !important;
    }
    .select2-container--bootstrap-5 .select2-selection__rendered {
        color: #333 !important;
        font-weight: 500;
    }
</style>